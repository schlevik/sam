stages:
  train-roberta-base-on-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/datasets/squad1/train-v1.1.json
      --model-path roberta-base --model-type roberta --eval-file data/datasets/squad1/dev-v1.1.json
      --save-model-folder models/roberta-base-squad1 --do-eval-after-training --num-workers
      8 --fp16 --per-gpu-train-batch-size 8 --save-steps 0 --max-answer-length 30
      --debug-features
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/roberta-base-squad1
  train-albert-base-v2-on-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/datasets/squad1/train-v1.1.json
      --model-path albert-base-v2 --model-type albert-base-v2 --eval-file data/datasets/squad1/dev-v1.1.json
      --save-model-folder models/albert-base-v2-squad1 --do-eval-after-training --num-workers
      8 --per-gpu-train-batch-size 24 --max-answer-length 30 --fp16 --save-steps 0
      --debug-features
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/albert-base-v2-squad1
  train-albert-xxlarge-v2-on-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/datasets/squad1/train-v1.1.json
      --model-path albert-xxlarge-v2 --model-type albert-xxlarge-v2 --eval-file data/datasets/squad1/dev-v1.1.json
      --save-model-folder models/albert-xxlarge-v2-squad1 --do-eval-after-training
      --num-workers 8 --per-gpu-train-batch-size 2 --max-answer-length 30 --gradient-accumulation-steps
      128 --fp16 --save-steps 0 --debug-features
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/albert-xxlarge-v2-squad1
  train-bert-large-uncased-on-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/datasets/squad1/train-v1.1.json
      --model-path bert-large-uncased --model-type bert-large-uncased --eval-file
      data/datasets/squad1/dev-v1.1.json --save-model-folder models/bert-large-uncased-squad1
      --do-eval-after-training --num-workers 8 --per-gpu-train-batch-size 2 --max-answer-length
      30 --gradient-accumulation-steps 128 --fp16 --save-steps 0 --debug-features
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/bert-large-uncased-squad1
  train-roberta-large-on-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/datasets/squad1/train-v1.1.json
      --model-path roberta-large --model-type roberta-large --eval-file data/datasets/squad1/dev-v1.1.json
      --save-model-folder models/roberta-large-squad1 --do-eval-after-training --num-workers
      8 --per-gpu-train-batch-size 8 --max-answer-length 30 --gradient-accumulation-steps
      32 --fp16 --save-steps 1000 --debug-features --eval-all-checkpoints
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/roberta-large-squad1
  train-albert-large-v2-on-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/datasets/squad1/train-v1.1.json
      --model-path albert-large-v2 --model-type albert-large-v2 --eval-file data/datasets/squad1/dev-v1.1.json
      --save-model-folder models/albert-large-v2-squad1 --do-eval-after-training --num-workers
      8 --per-gpu-train-batch-size 8 --max-answer-length 30 --gradient-accumulation-steps
      32 --fp16 --debug-features --eval-all-checkpoints
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/albert-large-v2-squad1
  train-albert-xlarge-v2-on-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/datasets/squad1/train-v1.1.json
      --model-path albert-xlarge-v2 --model-type albert-xlarge-v2 --eval-file data/datasets/squad1/dev-v1.1.json
      --save-model-folder models/albert-xlarge-v2-squad1 --do-eval-after-training
      --num-workers 8 --per-gpu-train-batch-size 4 --max-answer-length 30 --gradient-accumulation-steps
      64 --fp16 --debug-features --eval-all-checkpoints
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/albert-xlarge-v2-squad1
  train-bert-base-uncased-on-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/datasets/squad1/train-v1.1.json
      --model-path bert-base-uncased --model-type bert-base-uncased --eval-file data/datasets/squad1/dev-v1.1.json
      --save-model-folder models/bert-base-uncased-squad1 --do-eval-after-training
      --num-workers 8 --per-gpu-train-batch-size 32 --max-answer-length 30 --gradient-accumulation-steps
      8 --fp16 --debug-features --eval-all-checkpoints
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/bert-base-uncased-squad1
  train-t5-small-on-squad1:
    cmd: PYTHONPATH=. python scripts/t5.py --model_name_or_path t5-small --output_dir
      models/t5-small-squad1 --train_file data/datasets/squad1/train-v1.1.json --eval_file
      data/datasets/squad1/dev-v1.1.json --do_train --do_eval --num_workers 8 --per_device_train_batch_size
      8 --gradient_accumulation_steps 32 --fp16
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/t5-small-squad1
  train-t5-base-on-squad1:
    cmd: PYTHONPATH=. python scripts/t5.py --model_name_or_path t5-base --output_dir
      models/t5-base-squad1 --train_file data/datasets/squad1/train-v1.1.json --eval_file
      data/datasets/squad1/dev-v1.1.json --do_train --do_eval --num_workers 8 --per_device_train_batch_size
      8 --gradient_accumulation_steps 32 --fp16
    deps:
    - data/datasets/squad1/dev-v1.1.json
    - data/datasets/squad1/train-v1.1.json
    outs:
    - models/t5-base-squad1
  generate-train:
    cmd: python main.py generate-balanced --config conf/finetune.json --seed 56 --num-workers
      8 --do-save --out-path data/football/split/train/ --multiplier 100 --split train
      --combine
    deps:
    - conf/finetune.json
    - scripts/generate_balanced.py
    outs:
    - data/football/split/train/combined-train.json
  generate-train-mask-q:
    cmd: python main.py generate-balanced --config conf/finetune.json --seed 56 --num-workers
      8 --do-save --out-path data/football/split-mask-q/train/ --multiplier 100 --split
      train --combine --mask-q
    deps:
    - conf/finetune.json
    - scripts/generate_balanced.py
    outs:
    - data/football/split-mask-q/train/combined-train.json
  generate-train-mask-p:
    cmd: python main.py generate-balanced --config conf/finetune.json --seed 56 --num-workers
      8 --do-save --out-path data/football/split-mask-p/train/ --multiplier 100 --split
      train --combine --mask-p --keep-answer-candidates
    deps:
    - conf/finetune.json
    - scripts/generate_balanced.py
    outs:
    - data/football/split-mask-p/train/combined-train.json
  generate-test-mask-q:
    cmd: python main.py generate-balanced --config conf/finetune.json --seed 38676
      --num-workers 8 --do-save --out-path data/football/split-mask-q/test/ --multiplier
      20 --split test --mask-q
    deps:
    - conf/finetune.json
    - scripts/generate_balanced.py
    outs:
    - data/football/split-mask-q/test/baseline-test.json
    - data/football/split-mask-q/test/control-test.json
    - data/football/split-mask-q/test/intervention-test.json
  generate-test-mask-p:
    cmd: python main.py generate-balanced --config conf/finetune.json --seed 38676
      --num-workers 8 --do-save --out-path data/football/split-mask-p/test/ --multiplier
      20 --split test --mask-p --keep-answer-candidates
    deps:
    - conf/finetune.json
    - scripts/generate_balanced.py
    outs:
    - data/football/split-mask-p/test/baseline-test.json
    - data/football/split-mask-p/test/control-test.json
    - data/football/split-mask-p/test/intervention-test.json
  train-bert-baseline:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/football/split/train/combined-train.json
      --model-path bert-base-uncased --model-type bert --save-model-folder models/bert-baseline
      --num-workers 8 --per-gpu-train-batch-size 24 --max-answer-length 10 --debug-features
      --num-train-epochs 15 --overwrite-output-dir --save-steps 0 --per-gpu-eval-batch-size
      64 --gradient-accumulation-steps 3 --learning-rate 5e-5
    deps:
    - data/football/split/train/combined-train.json
    outs:
    - models/bert-baseline
  train-bert-mask-q-baseline:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/football/split-mask-q/train/combined-train.json
      --model-path bert-base-uncased --model-type bert --save-model-folder models/bert-mask-q-baseline
      --num-workers 8 --per-gpu-train-batch-size 24 --max-answer-length 10 --debug-features
      --num-train-epochs 15 --overwrite-output-dir --save-steps 0 --per-gpu-eval-batch-size
      64 --gradient-accumulation-steps 3 --learning-rate 5e-5
    deps:
    - data/football/split-mask-q/train/combined-train.json
    outs:
    - models/bert-mask-q-baseline
  train-bert-mask-p-baseline:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk train data/football/split-mask-p/train/combined-train.json
      --model-path bert-base-uncased --model-type bert --save-model-folder models/bert-mask-p-baseline
      --num-workers 8 --per-gpu-train-batch-size 24 --max-answer-length 10 --debug-features
      --num-train-epochs 15 --overwrite-output-dir --save-steps 0 --per-gpu-eval-batch-size
      64 --gradient-accumulation-steps 3 --learning-rate 5e-5
    deps:
    - data/football/split-mask-p/train/combined-train.json
    outs:
    - models/bert-mask-p-baseline
  predict-random-baselines:
    cmd: python main.py predict data/football/split/test/baseline-test.json data/football/split/test/control-test.json
      data/football/split/test/intervention-test.json --output-folder data/football/split/test/predictions/
      --model random-baseline --cls RandomBaseline --model educated-baseline --cls
      EducatedBaseline --model informed-baseline --cls InformedBaseline
    deps:
    - data/football/split/test/baseline-test.json
    - data/football/split/test/control-test.json
    - data/football/split/test/intervention-test.json
    outs:
    - data/football/split/test/predictions/baseline-test-educated-baseline.json
    - data/football/split/test/predictions/baseline-test-informed-baseline.json
    - data/football/split/test/predictions/baseline-test-random-baseline.json
    - data/football/split/test/predictions/control-test-educated-baseline.json
    - data/football/split/test/predictions/control-test-informed-baseline.json
    - data/football/split/test/predictions/control-test-random-baseline.json
    - data/football/split/test/predictions/intervention-test-educated-baseline.json
    - data/football/split/test/predictions/intervention-test-informed-baseline.json
    - data/football/split/test/predictions/intervention-test-random-baseline.json
  predict-bert-baseline:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk predictions
      data/football/split/test/baseline-test.json data/football/split/test/intervention-test.json
      data/football/split/test/control-test.json --model-path models/bert-baseline
      --model-type bert --out-folder data/football/split/test/predictions/ --max-answer-length
      10 --per-gpu-eval-batch-size 64
    deps:
    - data/football/split/test/baseline-test.json
    - data/football/split/test/control-test.json
    - data/football/split/test/intervention-test.json
    - models/bert-baseline
    outs:
    - data/football/split/test/predictions/baseline-test-bert-baseline.json
    - data/football/split/test/predictions/control-test-bert-baseline.json
    - data/football/split/test/predictions/intervention-test-bert-baseline.json
  predict-bert-mask-q-baseline:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk predictions
      data/football/split-mask-q/test/baseline-test.json data/football/split-mask-q/test/intervention-test.json
      data/football/split-mask-q/test/control-test.json --model-path models/bert-mask-q-baseline
      --model-type bert --out-folder data/football/split-mask-q/test/predictions/
      --max-answer-length 10 --per-gpu-eval-batch-size 64
    deps:
    - data/football/split-mask-q/test/baseline-test.json
    - data/football/split-mask-q/test/control-test.json
    - data/football/split-mask-q/test/intervention-test.json
    - models/bert-mask-q-baseline
    outs:
    - data/football/split-mask-q/test/predictions/baseline-test-bert-mask-q-baseline.json
    - data/football/split-mask-q/test/predictions/control-test-bert-mask-q-baseline.json
    - data/football/split-mask-q/test/predictions/intervention-test-bert-mask-q-baseline.json
  predict-bert-mask-p-baseline:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk predictions
      data/football/split-mask-p/test/baseline-test.json data/football/split-mask-p/test/intervention-test.json
      data/football/split-mask-p/test/control-test.json --model-path models/bert-mask-p-baseline
      --model-type bert --out-folder data/football/split-mask-p/test/predictions/
      --max-answer-length 10 --per-gpu-eval-batch-size 64
    deps:
    - data/football/split-mask-p/test/baseline-test.json
    - data/football/split-mask-p/test/control-test.json
    - data/football/split-mask-p/test/intervention-test.json
    - models/bert-mask-p-baseline
    outs:
    - data/football/split-mask-p/test/predictions/baseline-test-bert-mask-p-baseline.json
    - data/football/split-mask-p/test/predictions/control-test-bert-mask-p-baseline.json
    - data/football/split-mask-p/test/predictions/intervention-test-bert-mask-p-baseline.json
  generate-test:
    cmd: python main.py generate-balanced --config conf/finetune.json --seed 38676
      --num-workers 8 --do-save --out-path data/football/split/test/ --multiplier
      20 --split test
    deps:
    - conf/finetune.json
    - scripts/generate_balanced.py
    outs:
    - data/football/split/test/baseline-test.json
    - data/football/split/test/control-test.json
    - data/football/split/test/intervention-test.json
  evaluate-baselines:
    cmd: python main.py evaluate data/football/split/test/baseline-test.json data/football/split/test/intervention-test.json
      data/football/split/test/control-test.json --prediction-folder data/football/split/test/predictions/
      --output metrics/football/baselines/baselines.json --metric EMRelaxed
    deps:
    - data/football/split/test/baseline-test.json
    - data/football/split/test/control-test.json
    - data/football/split/test/intervention-test.json
    - data/football/split/test/predictions/
    metrics:
    - metrics/football/baselines/baselines.json:
        cache: false
  evaluate-baselines-mask-q:
    cmd: python main.py evaluate data/football/split-mask-q/test/baseline-test.json
      data/football/split-mask-q/test/intervention-test.json data/football/split-mask-q/test/control-test.json
      --prediction-folder data/football/split-mask-q/test/predictions/ --output metrics/football/baselines/baselines-mask-q.json
      --metric EMRelaxed
    deps:
    - data/football/split-mask-q/test/baseline-test.json
    - data/football/split-mask-q/test/control-test.json
    - data/football/split-mask-q/test/intervention-test.json
    - data/football/split-mask-q/test/predictions/
    metrics:
    - metrics/football/baselines/baselines-mask-q.json:
        cache: false
  evaluate-baselines-mask-p:
    cmd: python main.py evaluate data/football/split-mask-p/test/baseline-test.json
      data/football/split-mask-p/test/intervention-test.json data/football/split-mask-p/test/control-test.json
      --prediction-folder data/football/split-mask-p/test/predictions/ --output metrics/football/baselines/baselines-mask-p.json
      --metric EMRelaxed
    deps:
    - data/football/split-mask-p/test/baseline-test.json
    - data/football/split-mask-p/test/control-test.json
    - data/football/split-mask-p/test/intervention-test.json
    - data/football/split-mask-p/test/predictions/
    metrics:
    - metrics/football/baselines/baselines-mask-p.json:
        cache: false
  generate-sam:
    cmd: python main.py generate-balanced --config conf/evaluate.json --seed 56 --num-workers
      8 --do-save --out-path data/football/full --multiplier 35
    deps:
    - conf/evaluate.json
    - scripts/generate_balanced.py
    outs:
    - data/football/full/baseline.json
    - data/football/full/control.json
    - data/football/full/intervention.json
  predict-transformers-squad1:
    cmd: python main.py --debug --notify viktor.schlegel@manchester.ac.uk predictions
      data/football/full/baseline.json data/football/full/intervention.json data/football/full/control.json
      --model-path models/albert-base-v2-squad1 --model-type albert --model-path models/albert-large-v2-squad1
      --model-type albert --model-path models/albert-xlarge-v2-squad1 --model-type
      albert --model-path models/albert-xxlarge-v2-squad1 --model-type albert --model-path
      models/bert-base-uncased-squad1 --model-type bert --model-path models/bert-large-uncased-squad1
      --model-type bert --model-path models/roberta-base-squad1 --model-type roberta
      --model-path models/roberta-large-squad1 --model-type roberta --out-folder data/football/full/predictions/squad1
      --max-answer-length 10 --per-gpu-eval-batch-size 32
    deps:
    - data/football/full/baseline.json
    - data/football/full/control.json
    - data/football/full/intervention.json
    - models/albert-base-v2-squad1
    - models/albert-large-v2-squad1
    - models/albert-xlarge-v2-squad1
    - models/albert-xxlarge-v2-squad1
    - models/bert-base-uncased-squad1
    - models/bert-large-uncased-squad1
    - models/roberta-base-squad1
    - models/roberta-large-squad1
    outs:
    - data/football/full/predictions/squad1/baseline-albert-base-v2-squad1.json
    - data/football/full/predictions/squad1/baseline-albert-large-v2-squad1.json
    - data/football/full/predictions/squad1/baseline-albert-xlarge-v2-squad1.json
    - data/football/full/predictions/squad1/baseline-albert-xxlarge-v2-squad1.json
    - data/football/full/predictions/squad1/baseline-bert-base-uncased-squad1.json
    - data/football/full/predictions/squad1/baseline-bert-large-uncased-squad1.json
    - data/football/full/predictions/squad1/baseline-roberta-base-squad1.json
    - data/football/full/predictions/squad1/baseline-roberta-large-squad1.json
    - data/football/full/predictions/squad1/control-albert-base-v2-squad1.json
    - data/football/full/predictions/squad1/control-albert-large-v2-squad1.json
    - data/football/full/predictions/squad1/control-albert-xlarge-v2-squad1.json
    - data/football/full/predictions/squad1/control-albert-xxlarge-v2-squad1.json
    - data/football/full/predictions/squad1/control-bert-base-uncased-squad1.json
    - data/football/full/predictions/squad1/control-bert-large-uncased-squad1.json
    - data/football/full/predictions/squad1/control-roberta-base-squad1.json
    - data/football/full/predictions/squad1/control-roberta-large-squad1.json
    - data/football/full/predictions/squad1/intervention-albert-base-v2-squad1.json
    - data/football/full/predictions/squad1/intervention-albert-large-v2-squad1.json
    - data/football/full/predictions/squad1/intervention-albert-xlarge-v2-squad1.json
    - data/football/full/predictions/squad1/intervention-albert-xxlarge-v2-squad1.json
    - data/football/full/predictions/squad1/intervention-bert-base-uncased-squad1.json
    - data/football/full/predictions/squad1/intervention-bert-large-uncased-squad1.json
    - data/football/full/predictions/squad1/intervention-roberta-base-squad1.json
    - data/football/full/predictions/squad1/intervention-roberta-large-squad1.json
  evaluate-intervention-squad1:
    cmd: python main.py evaluate-intervention --baseline-file data/football/full/baseline.json
      --predictions-folder data/football/full/predictions/squad1 --control --output
      metrics/football/squad1/eoi.json --split-reasoning --split-num-modifier --split-sam
      --do-save
    deps:
    - data/football/full/baseline.json
    - data/football/full/control.json
    - data/football/full/intervention.json
    - data/football/full/predictions/squad1
    - scripts/evaluate_intervention.py
    metrics:
    - metrics/football/squad1/eoi.json:
        cache: false
